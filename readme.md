# Проект "Умная теплица"
## Авторы - студенты ТюмГУ ИБ-22.02
- Гбетоо Ромен
- Егоров Семён
- Кочнев Артём
- Москалева Алёна
- Новожилов Егор
- Панова Злата
- Шледевиц Виктор



## Краткое описание файлов проекта
### IoT-устройства
- /bots/uuids - хранит UUID каждого устройства в отдельных файлах
- /bots/config.py - хранит конфигурацию для работы ботов, а также шифрования
- /bots/DBMS_worker.py - класс для взаимодействия с БД
- /bots/device.py - базовый класс, на основе которого создаются все IoT-устройства
- /bots/encryption.py - функции шифрования/дешифрования
- /bots/IoT_devices.py - перечень и конфигурация различных IoT-устройств
- /bots/logic.py - вспомогательные функции, у нас работа с UUID
- /bots/main.py - точка входа. Создаёт устройства и запускает каждое в отдельном потоке
### Веб-сокет-сервер
- /servers/IoT-server/config.py - хранит конфигурацию для работы сервера, а также шифрования
- /servers/IoT-server/DBMS_worker.py - класс для взаимодействия с БД
- /servers/IoT-server/encryption.py - функции шифрования/дешифрования
- /servers/IoT-server/main.py - реализация и точка входа для локального веб-сокет-сервера
### Веб-сервер
- /servers/web-server/css/styles.css - хранит стили HTML-документов веб-сервера
- /servers/web-server/templates/base.html - хранит шаблон HTML. Содержит стили, меню
- /servers/web-server/templates/dashboard.html - содержит главную страницу с актуальной информацией
- /servers/web-server/templates/devices.html - внезапно, управление IoT-устройствами
- /servers/web-server/templates/devices.html - хранит страницу истории наблюдений
- /servers/web-server/templates/login.html - содержит страницу входа
- /servers/web-server/templates/rules.html - содержит страницу конфигурации правил
- /servers/web-server/templates/sectors.html - содержит страницу конфигурации секторов(теплиц)
- /servers/web-server/app.py - содержит реализацию веб-сервера на основе Flask
- /servers/web-server/DBMS_worker.py - класс для взаимодействия с БД
### Прочее
- /db_schema.png - ERD всех баз данных
- /readme.md - справочная информация, призванная упростить понимание принципов работы проекта
- /requirements.txt - библиотеки, фреймворки и пр. с используемыми версиями
- /run.sh - скрипт запуска всех систем, включая ботов + mariadb при необходимости



## Сценарий взаимодействия пользователя с системой
1. Происходит авторизация по логину и паролю посредством веб-интерфейса, при наличии подписки открывается интерфейс для управления теплицей
2. На главном экране пользователь видит существующие секторы, перечень замеряемых для них параметров, а также последние сработавшие правила. Изначально ничего этого нет
3. Пользователь переходит во вкладку со списком секторов и устройств
4. Для каждого устройства пользователь производит конфигурацию: к какому сектору устройство относится и всё) Перечень данных берётся из самого устройства, а пользователю виден его класс: термометр, обогреватель, вентиль или ещё что
5. На странице правил можно увидеть существующие правила, при необходимости их удалить или добавить новое. При добавлении указывается:
    - Поле данных определённой теплицы, на которое правило будет смотреть(температура, влажность или другое)
    - Тип условия (>, < и т.д.)
    - Значение, с которым будет сравниваться показатель теплицы
    - Сообщение. Состоит из времени работы и режима работы
    - Конечное устройство, на которое будет отправлено сообщение в случае срабатывания правила
В случае окончания подписки теплица продолжает функционирование, но блокируется доступ к веб-интерфейсу, и, соответственно, настройке системы + её мониторингу



## Пояснения
### Расшифровка поля rule_condition в таблице rules локального веб-сокет-сервера
1. ">"
2. "<"
3. "="
4. "≠"